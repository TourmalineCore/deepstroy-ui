import{objectWithoutProperties as t,slicedToArray as e,objectSpread2 as a,extends as o,asyncToGenerator as r}from"../../_virtual/_rollupPluginBabelHelpers.js";import n,{useState as i,useRef as l,useCallback as s,useMemo as u,useEffect as d}from"react";import{debounce as c}from"lodash";import p from"axios";import{useTable as m,useResizeColumns as f,useFlexLayout as g,useFilters as b,useSortBy as h,usePagination as v}from"react-table";import S from"../DesktopTable/DesktopTable.js";import C from"../MobileTable/MobileTable.js";import y from"../Filters/DefaultColumnFilter.js";import{useWindowDimensions as D}from"../../hooks/useWindowDimensions.js";import{getDefaultTablePageSize as T}from"../DesktopTable/components/DesktopPagination/paginationUtils.js";import j,{ACTIONS_COLUMN_ID as x}from"../Actions/actionsColumnFactory.js";import{getDefaultSortBy as B,getDefaultFilters as P,saveFilters as k,saveSortBy as F}from"../../utils/tableStateService.js";import{i18n as M}from"../../i18n/i18n.js";var q=require("qs"),w={};function z(z){var I=z.tableId,E=z.columns,L=z.order,W=void 0===L?{}:L,A=z.refresh,H=void 0!==A&&A,R=z.language,U=void 0===R?"en":R,G=z.renderMobileTitle,_=z.httpClient,V=void 0===_?p:_,J=z.apiHostUrl,K=z.dataPath,N=z.authToken,O=z.requestMethod,Q=void 0===O?"GET":O,X=z.requestData,Y=void 0===X?w:X,Z=z.customDataLoader,$=z.maxStillMobileBreakpoint,tt=void 0===$?800:$,et=z.loading,at=z.isStriped,ot=z.actions,rt=void 0===ot?[]:ot,nt=z.onPageDataLoaded,it=void 0===nt?function(){}:nt,lt=z.onFiltersChange,st=void 0===lt?function(){}:lt,ut=z.enableTableStatePersistance,dt=void 0!==ut&&ut,ct=t(z,["tableId","columns","order","refresh","language","renderMobileTitle","httpClient","apiHostUrl","dataPath","authToken","requestMethod","requestData","customDataLoader","maxStillMobileBreakpoint","loading","isStriped","actions","onPageDataLoaded","onFiltersChange","enableTableStatePersistance"]);if(!I)throw new Error("non-empty and globally unique tableId is required");var pt=i({data:[],pageCount:0,totalCount:0}),mt=e(pt,2),ft=mt[0],gt=mt[1],bt=i(!1),ht=e(bt,2),vt=ht[0],St=ht[1],Ct=l(0),yt=s(c((function(t,e){return Lt.apply(this,arguments)}),300),[]),Dt=u((function(){return{Filter:y,minWidth:80,width:150,maxWidth:400}}),[]);rt.length>0&&(E.find((function(t){return t.id===x}))||E.push(j(rt,M(U))));var Tt=ft.data,jt=ft.pageCount,xt=ft.totalCount,Bt=m(a({columns:E,data:Tt,defaultColumn:Dt,initialState:{pageSize:T(I),sortBy:B(I,[W]),filters:P(I,[])},disableMultiSort:!0,disableSortRemove:!0,manualPagination:!0,manualFilters:!0,manualSortBy:!0,pageCount:jt},ct),f,g,b,h,v),Pt=Bt.setPageSize,kt=Bt.gotoPage,Ft=Bt.state,Mt=Ft.pageIndex,qt=Ft.pageSize,wt=Ft.filters,zt=Ft.sortBy,It=D().width>tt;d((function(){Pt(It?T(I):10),kt(0)}),[It]),dt&&(d((function(){k(I,wt)}),[wt]),d((function(){F(I,zt)}),[zt])),d((function(){st(wt)}),[wt]),d((function(){yt({pageIndex:Mt,pageSize:qt,filters:wt,sortBy:zt},{requestData:Y})}),[Mt,qt,wt.map((function(t){return"".concat(t.ud,":").concat(t.value)})).join(";"),"".concat(zt[0].id,":").concat(zt[0].desc),H,Y]);var Et=E.every((function(t){return!t.Footer}));return It?n.createElement(S,o({},Bt,{tableId:I,languageStrings:M(U),noFooter:Et,totalCount:xt,loading:et||vt,isStriped:at})):n.createElement(C,o({},Bt,{renderMobileTitle:G,languageStrings:M(U),noFooter:Et,totalCount:xt,loading:et||vt,actions:rt}));function Lt(){return(Lt=r(regeneratorRuntime.mark((function t(e,o){var r,n,i,l,s,u,d,c,p,m,f,g,b,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.pageIndex,n=e.pageSize,i=e.filters,l=e.sortBy,s=o.requestData,u=l[0],d=u.id,c=u.desc,p=++Ct.current,m={draw:p,page:r+1,pageSize:n,orderBy:d,orderingDirection:c?"desc":"asc",filteredByColumns:i.map((function(t){return t.id})),filteredByValues:i.map((function(t){return t.value.replace(/,/g,"")}))},f=a({},s),St(!0),g=Z||V,t.next=10,g({url:"".concat(J).concat(K),method:Q,headers:Wt(),params:m,data:f,paramsSerializer:function(t){return q.stringify(t,{arrayFormat:"repeat"})}});case 10:if(b=t.sent,(h=b.data).draw===Ct.current){t.next=14;break}return t.abrupt("return");case 14:gt(a(a({},ft),{},{data:h.list,totalCount:h.totalCount,params:m,postData:f,pageCount:Math.ceil(h.totalCount/n)})),it(h.list),St(!1);case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Wt(){return{Authorization:"Bearer ".concat(N),language:U}}}export default z;
